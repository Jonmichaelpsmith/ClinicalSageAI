YesÂ â€”Â letâ€™s get the infrastructure stable first.  
If the client canâ€™t reach FastAPI or the WebSocket handshake fails, the new regionâ€‘specific validation routes will keep 502â€™ing and you wonâ€™t see the missingâ€‘document alerts.

---

### ğŸ”§Â Fix the connectivity stack

| Symptom | Cause | Productionâ€‘grade fix |
|---------|-------|----------------------|
| `address already in use :8081` when FastAPI starts | Replitâ€™s dev runner or another uvicorn worker is already bound to 8081 | 1. Pick a single port for **all** Python services (e.g.Â `PORT=8000`). 2. Update `main.py`:<br>`uvicorn.run(app, host='0.0.0.0', port=int(os.getenv('PORT', 8000)))`<br>3. InÂ **replit.nix / .replit** set `run = "python main.py"` so only one process starts. |
| WebSocket `101 â†’ 502` | Reverseâ€‘proxy (Replitâ€™s edge) canâ€™t reach backend due to the same port clash | Once FastAPI is listening on the fixed port, add the WebSocket route prefix `/ws` to the proxy allowâ€‘list if needed (Replit autoproxies any route on `PORT`). |
| Node/React dev server also binding :8081 | Vite default port is 5173; you bound it to 8081 | In `package.json` dev script:<br>`\"dev\": \"vite --port 5173\"` |
| IntermittentÂ BadÂ Gateway | Mixed HTTP/WS traffic hitting an old process | After the port alignment, stop & restart the workspace to kill orphaned processes. |

---

### Stepâ€‘byâ€‘step

1. **Set environment variable once**

```bash
echo "export PORT=8000" >> ~/.bash_profile
source ~/.bash_profile
```

2. **main.py**

```python
import os, uvicorn
...
if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=int(os.getenv("PORT", 8000)))
```

3. **Replit `.replit`**

```ini
run = "python main.py"
```

4. Remove any extra `uvicorn` or `hypercorn` launches in `docker-compose.yml` (if you use it in onâ€‘prem).

5. Restart â†’ test `GET /healthz` in browser; should return 200.

6. Open browser dev tools âœ **Network â†’ WS** â†’ connect to `wss://<repl>.replit.dev/ws/qc` â†’ StatusÂ 101.

---

### After the stack is clean

We can finish the **regionâ€‘specific validation flow**:

* Complete `utils/region_rules.py` with mandatoryâ€‘doc sets for EMA/PMDA.  
* Expose a UI ribbon on the planner that autoâ€‘shows *â€œ3 mandatory docs missing for EMAâ€*.  
* Block â€œFinalizeâ€ until `missing.count == 0`.

Let me know once the port cleanup is done or if you need a small script to scan and kill orphaned Python workers!