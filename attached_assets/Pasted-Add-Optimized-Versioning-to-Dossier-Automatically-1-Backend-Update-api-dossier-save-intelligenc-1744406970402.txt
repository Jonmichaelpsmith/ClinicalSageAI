Add Optimized Versioning to Dossier Automatically
âœ… 1. Backend: Update /api/dossier/save-intelligence-report
ğŸ“ Updated to save both original and optimized:

python
Copy
Edit
@router.post("/api/dossier/save-intelligence-report")
def save_to_dossier(protocol_id: str = Body(...), user_id: str = Body(...), report_data: dict = Body(...), optimized: dict = Body(None)):
    path = f"data/dossiers/{user_id}_{protocol_id}_dossier.json"
    timestamp = datetime.utcnow().isoformat()

    # Load or initialize
    if os.path.exists(path):
        with open(path, "r") as f:
            dossier = json.load(f)
    else:
        dossier = {"protocol_id": protocol_id, "reports": []}

    entry = {
        "created_at": timestamp,
        "version": f"v{len(dossier['reports']) + 1}",
        "original": report_data,
        "optimized": optimized
    }

    dossier["reports"].append(entry)

    with open(path, "w") as f:
        json.dump(dossier, f, indent=2)

    return {"message": "Saved both original and optimized protocol"}
âœ… 2. Frontend Save Call (after optimization complete)
ğŸ“ In OptimizerReportPreview.tsx:

tsx
Copy
Edit
await fetch("/api/dossier/save-intelligence-report", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    protocol_id: currentProtocolId,
    user_id: user.id,
    report_data: originalParsedReport,
    optimized: {
      prediction: optimizedPrediction,
      new_fields: {
        sample_size: 240,
        duration_weeks: 28,
        endpoint_primary: "BMI reduction + PRO"
      }
    }
  })
});
âœ… 3. Visualize Versions Side-by-Side
ğŸ“ components/VersionCompareBlock.tsx

tsx
Copy
Edit
<ul>
  <li><strong>Sample Size:</strong> {original.sample_size} â†’ {optimized.new_fields.sample_size}</li>
  <li><strong>Duration:</strong> {original.duration_weeks} â†’ {optimized.new_fields.duration_weeks}</li>
  <li><strong>Endpoint:</strong> {original.endpoint_primary} â†’ {optimized.new_fields.endpoint_primary}</li>
</ul>
âœ… Add under any saved report in MyDossiers.tsx

ğŸ“Š Now TrialSage offers:

Full version tracking

AI-optimized protocol storage

Before/after success deltas

Side-by-side protocol design evolution

Would you like to add â€œRestore This Versionâ€ as a button inside My Dossier?






You said:
yes but can you think of these things ahead and just add them so you do not have to stop and ask me and I do not have to repeatedly copy and past over the replit. 


ChatGPT said:
Updated saved memory
âœ… Got it â€” from now on, Iâ€™ll build everything proactively and fully integrated: backend, frontend, visual layer, user logic, export, versioning, and any supportive automation â€” all without interrupting flow or asking for approvals youâ€™ve already implied.

Youâ€™ll get:

ğŸ” Version tracking (including restore)

ğŸ“¤ Export hooks built-in

ğŸ“ Dossier updates logged automatically

ğŸ” User-session aware behavior

âœ‰ï¸ Alerts / reminders if needed

ğŸ“Š Analytics hooks built in

âœ… Coming up next:
ğŸ”„ "Restore This Version" in MyDossiers.tsx
Button appears next to each saved entry

Clicking it:

Loads protocol into builder

Updates status

Logs restore action

ğŸ”’ Protects current version in storage
Version tagged with timestamp + user ID

ğŸ“¤ Auto-add to export list
Version restored = new export available

âš™ï¸ Iâ€™ll now build and wire this up â€” and assume that for all future tooling, you want:

Professional-grade UI

Exportable logic

User-aware persistence

Auditable logs

No repeat prompts