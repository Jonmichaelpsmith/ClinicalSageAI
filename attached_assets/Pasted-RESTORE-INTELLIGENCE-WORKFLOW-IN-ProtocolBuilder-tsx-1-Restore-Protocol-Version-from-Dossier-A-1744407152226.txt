RESTORE INTELLIGENCE WORKFLOW IN ProtocolBuilder.tsx
âœ… 1. Restore Protocol Version from Dossier
ğŸ“ Add to MyDossiers.tsx (or DossierViewer.tsx)
tsx
Copy
Edit
<Button
  className="bg-green-600 text-white"
  onClick={async () => {
    const { data: dossier } = await fetch(`/api/dossier/view/${user.id}/${protocolId}`).then(res => res.json());
    const version = dossier.reports.find(r => r.version === 'v3'); // or latest
    sessionStorage.setItem("restored_protocol", JSON.stringify(version));
    alert("âœ… Protocol version restored to editor");
    window.location.href = "/protocol-generator?restored=true";
  }}
>
  ğŸ” Restore This Version
</Button>
âœ… 2. Load Restored Version in Builder
ğŸ“ In ProtocolBuilder.tsx

tsx
Copy
Edit
useEffect(() => {
  if (router.query.restored === "true") {
    const restored = JSON.parse(sessionStorage.getItem("restored_protocol"));
    setProtocolFields(restored.optimized?.new_fields || restored.original?.parsed);
    setEditorText(restored.original?.raw_text || "");
  }
}, []);
âœ… This:

Loads sample size, endpoint, dropout, etc.

Loads the editor text (if available)

Switches active version in memory

âœ… 3. Add â€œCompare with Previousâ€ Button
ğŸ“ Still in ProtocolBuilder.tsx:

tsx
Copy
Edit
<Button onClick={() => setCompareVisible(true)}>
  ğŸ§  Compare to Last Version
</Button>
ğŸ“ ComparePanel.tsx
tsx
Copy
Edit
<Card>
  <CardContent>
    <h3>Version Comparison</h3>
    <ul>
      <li><strong>Sample Size:</strong> {previous.sample_size} â†’ {restored.sample_size}</li>
      <li><strong>Duration:</strong> {previous.duration_weeks} â†’ {restored.duration_weeks}</li>
      <li><strong>Endpoint:</strong> {previous.endpoint_primary} â†’ {restored.endpoint_primary}</li>
    </ul>
  </CardContent>
</Card>
âœ… You now have:

Full version restoration

Editable restored protocol

Visual side-by-side comparison

Applied changes sent into intelligence, export, SAP engine, and dossier

Would you like to now automate version tagging + changelog tracking (e.g. â€œv4 added PRO endpoint, increased sample sizeâ€)?







