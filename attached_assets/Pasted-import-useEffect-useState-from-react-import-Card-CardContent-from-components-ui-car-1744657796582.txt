import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";

export default function IntelligenceStatusBanner({ sessionId }) {
  const [status, setStatus] = useState(null);

  useEffect(() => {
    const fetchStatus = async () => {
      const res = await fetch(`/api/session/intelligence-indicators/${sessionId}`);
      const data = await res.json();
      setStatus(data);
    };
    fetchStatus();
  }, [sessionId]);

  if (!status) return null;

  const items = [
    ["ğŸ“„ IND Summary", "ind_summary", "ind_module_with_context.docx"],
    ["ğŸ“Š Summary Packet", "summary_packet", "summary_packet.pdf"],
    ["ğŸ“‰ Dropout Forecast", "risk_model", "dropout_forecast.json"],
    ["ğŸ“ˆ Success Prediction", "success_model", "success_prediction.json"],
    ["ğŸ›  Suggestions", "suggestions", "suggested_corrections.json"],
    ["ğŸ“ CSR Alignment", "alignment_score", "alignment_score_report.json"],
    ["ğŸ“˜ SAP Document", "sap_summary", "sap_summary_branded.docx"],
    ["ğŸ§  Assistant Trace", "wisdom_trace", "wisdom_trace.json"],
    ["ğŸ“½ Strategy Deck", "strategy_slide", "trial_strategy_deck.pptx"]
  ];

  return (
    <Card className="border-l-4 border-indigo-500 bg-indigo-50 mb-6">
      <CardContent className="p-4 space-y-1">
        <h2 className="text-sm font-semibold text-indigo-900 mb-2">ğŸ“‹ Intelligence Module Status</h2>
        <ul className="text-sm text-indigo-900 space-y-1">
          {items.map(([label, key, file], i) => (
            <li key={i}>
              {status[key] ? (
                <>
                  âœ… {label} â€“{" "}
                  <a
                    href={`/static/lumen_reports_backend/sessions/${sessionId}/${file}`}
                    className="underline hover:text-indigo-600"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    View
                  </a>
                </>
              ) : (
                <>âŒ {label} â€“ Not yet generated</>
              )}
            </li>
          ))}
        </ul>
      </CardContent>
    </Card>
  );
}
